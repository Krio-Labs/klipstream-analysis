<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thumbnail Fix Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a1a;
            color: white;
        }
        .test-case {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #333;
            border-radius: 8px;
            background: #2a2a2a;
        }
        .thumbnail {
            width: 178px;
            height: 100px;
            border-radius: 8px;
            margin: 10px 0;
        }
        .result {
            margin: 10px 0;
            padding: 10px;
            background: #333;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>Thumbnail Processing Fix Test</h1>
    
    <div class="test-case">
        <h3>Test Case 1: Processing Video (404_processing)</h3>
        <p><strong>Input URL:</strong> https://vod-secure.twitch.tv/_404/404_processing_%{width}x%{height}.png</p>
        <div class="result" id="result1"></div>
        <img class="thumbnail" id="thumb1" alt="Test thumbnail 1">
    </div>
    
    <div class="test-case">
        <h3>Test Case 2: Normal Video Thumbnail</h3>
        <p><strong>Input URL:</strong> https://static-cdn.jtvnw.net/cf_vods/d1m7jfoe9zdc1j/da338e1aa4f0bb3e676e_jynxzi_321510667517_1744832205//thumb/thumb0-%{width}x%{height}.jpg</p>
        <div class="result" id="result2"></div>
        <img class="thumbnail" id="thumb2" alt="Test thumbnail 2">
    </div>
    
    <div class="test-case">
        <h3>Test Case 3: No Thumbnail URL</h3>
        <p><strong>Input URL:</strong> null</p>
        <div class="result" id="result3"></div>
        <img class="thumbnail" id="thumb3" alt="Test thumbnail 3">
    </div>

    <script>
        // Simulate the thumbnail processing logic from the fix
        function processThumbnail(thumbnailUrl) {
            if (!thumbnailUrl) {
                return "/assets/placeholder-thumbnail.svg";
            }
            
            if (thumbnailUrl.includes("404_processing")) {
                return "/assets/placeholder-thumbnail.svg"; // Use placeholder for processing videos
            }
            
            return thumbnailUrl
                .replace("%{width}", "178")
                .replace("%{height}", "100");
        }

        // Test cases
        const testCases = [
            {
                input: "https://vod-secure.twitch.tv/_404/404_processing_%{width}x%{height}.png",
                resultId: "result1",
                thumbId: "thumb1"
            },
            {
                input: "https://static-cdn.jtvnw.net/cf_vods/d1m7jfoe9zdc1j/da338e1aa4f0bb3e676e_jynxzi_321510667517_1744832205//thumb/thumb0-%{width}x%{height}.jpg",
                resultId: "result2",
                thumbId: "thumb2"
            },
            {
                input: null,
                resultId: "result3",
                thumbId: "thumb3"
            }
        ];

        testCases.forEach((testCase, index) => {
            const result = processThumbnail(testCase.input);
            const resultElement = document.getElementById(testCase.resultId);
            const thumbElement = document.getElementById(testCase.thumbId);
            
            resultElement.innerHTML = `
                <strong>Processed Result:</strong> ${result}<br>
                <strong>Expected:</strong> ${testCase.input && testCase.input.includes("404_processing") ? "Placeholder" : testCase.input ? "Processed URL" : "Placeholder"}<br>
                <strong>Status:</strong> ${
                    (testCase.input && testCase.input.includes("404_processing") && result === "/assets/placeholder-thumbnail.svg") ||
                    (!testCase.input && result === "/assets/placeholder-thumbnail.svg") ||
                    (testCase.input && !testCase.input.includes("404_processing") && result.includes("178x100"))
                    ? "✅ PASS" : "❌ FAIL"
                }
            `;
            
            thumbElement.src = result;
            thumbElement.onerror = function() {
                this.style.background = "#ff4444";
                this.style.display = "flex";
                this.style.alignItems = "center";
                this.style.justifyContent = "center";
                this.innerHTML = "Image failed to load";
            };
        });
    </script>
</body>
</html>
